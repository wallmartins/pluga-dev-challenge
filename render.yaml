services:
  # PostgreSQL Database
  - type: pserv
    name: pluga-db
    plan: free
    ipAddress: private
    databaseName: pluga_prod
    user: postgres

  # Rails Backend API (usando Docker)
  - type: web
    name: pluga-backend
    plan: free
    dockerfilePath: ./server/Dockerfile
    dockerContext: .
    envVars:
      - key: RAILS_ENV
        value: production
      - key: RAILS_LOG_TO_STDOUT
        value: "true"
      - key: RAILS_SERVE_STATIC_FILES
        value: "true"
      - key: RAILS_TARGET
        value: production
      - key: SECRET_KEY_BASE
        sync: false
      - key: GEMINI_KEY
        sync: false
      - key: CLIENT_ORIGIN
        value: https://pluga-frontend.onrender.com
      - key: DATABASE_URL
        fromDatabase:
          name: pluga-db
          property: connectionString
    healthCheckPath: /up
    healthCheckStartDelay: 30
    connectToDatabase: true

  # Next.js Frontend (usando Docker)
  - type: web
    name: pluga-frontend
    plan: free
    dockerfilePath: ./client/Dockerfile
    dockerContext: .
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_API_BASE_URL
        value: https://pluga-backend.onrender.com
